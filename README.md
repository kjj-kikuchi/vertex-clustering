# QEMを用いた頂点クラスタリングによるメッシュ簡略化

<img src = "snapshot00.png" width = 50%><img src = "snapshot01.png" width = 50%>


### 概略

頂点クラスタリングによりメッシュ簡略化を行う．  
これはメッシュをセルで区切り，各セルの代表点を計算することで簡略化する手法である．  
初期に提案された手法で，単純だが出力メッシュは低品質である．
代表点の決め方は
* セルに含まれる頂点の重心
* セルに含まれる三角形の重心
* セルに含まれる三角形に対するQEM(Quadric Error Metric)

などあるが，より高品質となるQEMを用いて計算する．  
QEMとは，三角形の集合を一つの点で近似するときの近似誤差を測るものである．点と平面の距離の２乗和として定義される．  
代表点はQEMを最小にする位置に配置する．  

高速化のため，3次元グリッドはセルから新頂点番号へのマップを使った疎グリッドで表現する．このマップは(ix, iy, iz)をキーとするハッシュテーブル`std::unordered_map`を使用する．`Key`として`Eigen::Vector3i`型を使いたいが，ハッシュ値を計算できないため`EigenVector3iHasher`クラスを用意する．

### 実行結果

- 入力 : `lucy.obj`  （頂点数14,027,872），セルの大きさ
- 出力 : `lucy15027_simplified.obj` （頂点数15,027）
- 簡略化にかかった時間 : 1.5549秒
 ```
Enter percentage of cell length : 0.0096        // bounding boxの最長辺に対する割合としてセルの大きさを入力
cell number :  62  36 106, 236592

Read mesh : 21.2073 sec
Vertex clustering : 1.5549 sec
```
